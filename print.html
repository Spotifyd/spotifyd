<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Spotifyd</title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="favicon.svg">
        
        
        <link rel="shortcut icon" href="favicon.png">
        
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="Introduction.html">Introduction</a></li><li class="chapter-item expanded "><a href="installation/index.html"><strong aria-hidden="true">1.</strong> Installation Instructions</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="installation/Raspberry-Pi.html"><strong aria-hidden="true">1.1.</strong> Installing on a Raspberry Pi</a></li><li class="chapter-item expanded "><a href="installation/Ubuntu.html"><strong aria-hidden="true">1.2.</strong> Installing on Ubuntu (from source)</a></li><li class="chapter-item expanded "><a href="installation/Cross-Compiling-on-Ubuntu.html"><strong aria-hidden="true">1.3.</strong> Cross Compiling on Ubuntu</a></li><li class="chapter-item expanded "><a href="installation/MacOS.html"><strong aria-hidden="true">1.4.</strong> Installing with Homebrew on macOS</a></li><li class="chapter-item expanded "><a href="installation/FreeBSD.html"><strong aria-hidden="true">1.5.</strong> Installing on FreeBSD</a></li></ol></li><li class="chapter-item expanded "><a href="config/index.html"><strong aria-hidden="true">2.</strong> Configuration</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/Cli.html"><strong aria-hidden="true">2.1.</strong> CLI options</a></li><li class="chapter-item expanded "><a href="config/File.html"><strong aria-hidden="true">2.2.</strong> Configuration file</a></li><li class="chapter-item expanded "><a href="config/services/index.html"><strong aria-hidden="true">2.3.</strong> Running as a Service</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="config/services/Systemd.html"><strong aria-hidden="true">2.3.1.</strong> Running as systemd service</a></li><li class="chapter-item expanded "><a href="config/services/MacOS.html"><strong aria-hidden="true">2.3.2.</strong> Running as launchd service (MacOS)</a></li></ol></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Spotifyd</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#introduction" id="introduction">Introduction</a></h1>
<p>This is the documentation of <a href="https://github.com/Spotifyd/spotifyd">spotifyd</a></p>
<blockquote>
<p>An open source Spotify client running as a UNIX daemon.</p>
</blockquote>
<p>These docs should be regarded as an extension of the <a href="https://github.com/Spotifyd/spotifyd">README</a> so please check there first before looking through the docs.</p>
<h1><a class="header" href="#installation" id="installation">Installation</a></h1>
<h2><a class="header" href="#provided-binaries" id="provided-binaries">Provided binaries</a></h2>
<p>We provide pre-built binaries through GitHub Actions for the more popular platforms: Linux, macOS and ARMv7. You can find them <a href="https://github.com/Spotifyd/spotifyd/releases">here</a>. For extra integrity, the file's SHA-512 gets calculated and uploaded as well.</p>
<p>The provided binaries come in two flavours, <code>slim</code> and <code>full</code>. Each are compiled with different features. <code>slim</code> only contains the platform's most used audio backend, <code>full</code> has also all optional features enabled (see <a href="installation/index.html#feature-flags">Feature Flags</a>).</p>
<h2><a class="header" href="#provided-packages" id="provided-packages">Provided packages</a></h2>
<p>There are packages for the following systems:</p>
<ul>
<li><a href="https://archlinux.org/packages/community/x86_64/spotifyd/">Arch Linux (via the Community repository)</a></li>
<li><a href="installation/./MacOS.html">MacOS (via homebrew)</a></li>
</ul>
<p>It is also available as a <a href="https://snapcraft.io/spotifyd">snap package</a>.</p>
<h2><a class="header" href="#building-from-source" id="building-from-source">Building from source</a></h2>
<p>You can also compile <code>Spotifyd</code> yourself, allowing you to make use of feature flags. <code>Spotifyd</code> is written in Rust. You can download the toolchain (compiler and package manager) over at <a href="https://rustup.rs">rustup.rs</a>. Follow their instructions to get started.</p>
<blockquote>
<p><strong>Note:</strong> Please make sure that you compile the package using the most recent <code>stable</code> version of Rust available through <code>rustup</code>. Some distro versions are quite outdated and might result in compilation errors.</p>
</blockquote>
<p><code>Spotifyd</code> might require additional libraries during build and runtime, depending on your platform and the way to compile it (static or dynamic). The following table shows the libraries needed for each OS respectively.</p>
<table><thead><tr><th>Target Platform</th><th>Libraries</th></tr></thead><tbody>
<tr><td>Fedora</td><td>alsa-lib-devel make gcc</td></tr>
<tr><td>openSUSE</td><td>alsa-devel make gcc</td></tr>
<tr><td>Debian</td><td>libasound2-dev libssl-dev libpulse-dev libdbus-1-dev</td></tr>
<tr><td>Arch</td><td>base-devel alsa-lib libogg libpulse dbus</td></tr>
<tr><td>macOS</td><td>dbus pkg-config portaudio</td></tr>
</tbody></table>
<blockquote>
<p><strong>Note:</strong> The package names for Linux are the ones used on Debian based distributions (like Ubuntu). You will need to adapt the packages for your distribution respectively.</p>
</blockquote>
<p>To compile the binary, run</p>
<pre><code class="language-bash">cargo build --release
</code></pre>
<p>To install the resulting binary, run</p>
<pre><code class="language-bash">cargo install --path . --locked
</code></pre>
<h3><a class="header" href="#installing-with-cargo" id="installing-with-cargo">Installing with Cargo</a></h3>
<p>If you have <code>cargo</code> installed, you can directly install <code>spotifyd</code> by running:</p>
<pre><code class="language-bash">cargo install spotifyd --locked
</code></pre>
<p>That will compile and install <code>spotifyd</code>'s latest version under <code>$HOME/.cargo/bin</code> for you.</p>
<h3><a class="header" href="#building-a-debian-package" id="building-a-debian-package">Building a Debian package</a></h3>
<p>You can use the <code>cargo-deb</code> create in order to build a Debian package from source.
Install it by:</p>
<pre><code class="language-bash">cargo install cargo-deb
</code></pre>
<p>Then you can build and install the Debian package with:</p>
<pre><code class="language-bash">cargo deb --install
</code></pre>
<p>Note, that when building a Debian package, the <code>--release</code> is passed to the
build command already and you do not need to specify it yourself.  See for the
flags that are set by default in <code>Cargo.toml</code>.</p>
<h3><a class="header" href="#feature-flags" id="feature-flags">Feature Flags</a></h3>
<p><code>Spotifyd</code> is split into a base package plus additional features that can be toggled on or off during compilation. Those can be split into two groups: The audio backend features that are responsible for playing back the music and additional functionality features, which enhance your experience using <code>spotifyd</code>.</p>
<p>To enable an additional audio backend, pass <code>&lt;audio_backend_name&gt;_backend</code> as a feature flag. We currently support <code>alsa</code>, <code>pulseaudio</code> and <code>portaudio</code>.</p>
<p><code>Spotifyd</code> provides the following additional functionality:</p>
<table><thead><tr><th>Feature Flag</th><th>Description</th></tr></thead><tbody>
<tr><td>dbus_keyring</td><td>Provides password authentication over the system's keyring (supports all platforms)</td></tr>
<tr><td>dbus_mpris</td><td>Provides multimedia key support (Linux only)</td></tr>
</tbody></table>
<blockquote>
<p><strong>Note:</strong> Compiling Spotifyd with all features and the pulseaudio backend on Ubuntu would result in the following command: <code>cargo build --release --no-default-features --features pulseaudio_backend,dbus_keyring,dbus_mpris</code></p>
</blockquote>
<h1><a class="header" href="#raspberry-pi-install-guide" id="raspberry-pi-install-guide">Raspberry Pi install guide</a></h1>
<p>This guide will help you to install <code>spotifyd</code> on a Raspberry Pi and have it always running.</p>
<h2><a class="header" href="#download" id="download">Download</a></h2>
<ol>
<li>Download the latest ARMv6 from <a href="https://github.com/Spotifyd/spotifyd/releases">https://github.com/Spotifyd/spotifyd/releases</a> (use <code>wget</code>)</li>
<li>Unzip the file: <code>tar xzf spotifyd-linux-arm6*</code>
You will now see a file called <code>spotifyd</code>. You can run it with <code>./spotifyd --no-daemon</code></li>
</ol>
<h2><a class="header" href="#systemd-daemon-file" id="systemd-daemon-file">Systemd daemon file</a></h2>
<p>Create a systemd service file and copy the <a href="https://github.com/Spotifyd/spotifyd/blob/master/contrib/spotifyd.service">default configuration</a> into it. Change <strong>ExecStart</strong> to where you unzipped the <code>spotifyd</code> binary.</p>
<pre><code class="language-bash">sudo nano /etc/systemd/user/spotifyd.service
</code></pre>
<p>if you want to run as user instead of root or have some <code>Failed to get D-Bus connection: Connection refused</code>, you define <code>spotifyd.service</code> in your home directory:</p>
<pre><code class="language-bash">mkdir -p ~/.config/systemd/user/
nano ~/.config/systemd/user/spotifyd.service
systemctl --user daemon-reload
</code></pre>
<h2><a class="header" href="#configuring-spotifyd" id="configuring-spotifyd">Configuring spotifyd</a></h2>
<p>Spotifyd comes pre-configured with defaults that should be working in most cases, but if you want to tweak it further to your needs, have a look at the <a href="installation/../config/">configuration section</a> of this book.</p>
<h2><a class="header" href="#start-the-service" id="start-the-service">Start the service</a></h2>
<pre><code class="language-bash">systemctl --user start spotifyd.service
</code></pre>
<p>Now see if you can find it in the normal Spotify client (Devices in right bottom corner). Retry the above steps if you can't find it.</p>
<h2><a class="header" href="#starting-spotifyd-at-boot" id="starting-spotifyd-at-boot">Starting spotifyd at boot</a></h2>
<pre><code class="language-bash">sudo loginctl enable-linger &lt;username&gt;
systemctl --user enable spotifyd.service
</code></pre>
<p>The first command is required to enable your user to run long-running services. Without it <code>systemd</code> would kill the <code>spotifyd</code> process as soon as you log out, and only run it when you log in.
Now <code>spotifyd</code> is always running on the Pi, so you can use it as a listening device remotely!</p>
<h1><a class="header" href="#ubuntu-install-guide" id="ubuntu-install-guide">Ubuntu install guide</a></h1>
<h2><a class="header" href="#install-the-rust-toolchain" id="install-the-rust-toolchain">Install the rust toolchain</a></h2>
<p>To install the latest rust toolchain, follow the installation instructions on <a href="https://rustup.rs/">rustup.rs</a>.</p>
<blockquote>
<p><strong>Note:</strong> If you installed rust before via apt, you need to remove it before installing rustup.
We recommend to always use the latest version and don't guarantee compatibility with older ones.</p>
</blockquote>
<h2><a class="header" href="#install-the-requirements" id="install-the-requirements">Install the requirements</a></h2>
<pre><code class="language-bash">sudo apt install libasound2-dev libssl-dev pkg-config
</code></pre>
<h2><a class="header" href="#clone-the-repository" id="clone-the-repository">Clone the repository</a></h2>
<pre><code class="language-bash">git clone https://github.com/Spotifyd/spotifyd.git
</code></pre>
<h2><a class="header" href="#building-spotifyd" id="building-spotifyd">Building spotifyd</a></h2>
<p>This takes a while...</p>
<pre><code class="language-bash">cd spotifyd
cargo build --release
</code></pre>
<p>The resulting binary will be placed in <code>target/release/spotifyd</code></p>
<h2><a class="header" href="#running-spotifyd" id="running-spotifyd">Running spotifyd</a></h2>
<p>You can run it using <code>./target/release/spotifyd</code></p>
<h1><a class="header" href="#ubuntu-compilation-guide" id="ubuntu-compilation-guide">Ubuntu compilation guide</a></h1>
<p>These are some notes on cross-compiling, that worked on WSL xenial Ubuntu.</p>
<h3><a class="header" href="#activate-the-cross-compilation-in-dpkg" id="activate-the-cross-compilation-in-dpkg">Activate the cross compilation in dpkg</a></h3>
<pre><code class="language-bash">dpkg --add-architecture armhf
sed 's/deb http/deb \[arch=amd64,i386\] http/' -i /etc/apt/sources.list
echo &gt;/etc/apt/sources.list &lt;&lt;EOF
deb [arch=armhf] http://ports.ubuntu.com/ $(lsb_release -cs) main universe restricted multiverse
deb [arch=armhf] http://ports.ubuntu.com/ $(lsb_release -cs)-updates main universe restricted multiverse
deb [arch=armhf] http://ports.ubuntu.com/ $(lsb_release -cs)-security main universe restricted multiverse
EOF
apt update
</code></pre>
<h3><a class="header" href="#install-dependency-libraries" id="install-dependency-libraries">Install dependency libraries</a></h3>
<pre><code class="language-bash">apt install libssl-dev:armhf libasound2-dev:armhf
</code></pre>
<h3><a class="header" href="#replace-standard-rust-with-rustup-and-activate-the-target-architecture" id="replace-standard-rust-with-rustup-and-activate-the-target-architecture">Replace standard rust with rustup and activate the target architecture</a></h3>
<pre><code class="language-bash">apt remove rustc
curl https://sh.rustup.rs -sSf | sh
rustup target add arm-unknown-linux-gnueabihf
</code></pre>
<h3><a class="header" href="#build" id="build">Build</a></h3>
<pre><code class="language-bash">PKG_CONFIG_PATH=/usr/lib/arm-linux-gnueabihf/pkgconfig PKG_CONFIG_ALLOW_CROSS=1 cargo build --target=arm-unknown-linux-gnueabihf --release
</code></pre>
<h1><a class="header" href="#macos-installation-guide" id="macos-installation-guide">MacOS installation Guide</a></h1>
<p>spotifyd is available via Homebrew and can be installed as follows:</p>
<p><code>brew install spotifyd</code></p>
<p>One can then enable it as a service at startup:</p>
<p><code>brew services start spotifyd</code></p>
<h1><a class="header" href="#freebsd-install-guide" id="freebsd-install-guide">FreeBSD install guide</a></h1>
<p>This guide will help you to install <code>spotifyd</code> on FreeBSD and have it always running.</p>
<p><code>spotifyd</code> is available for the FreeBSD architectures :</p>
<ul>
<li>amd64</li>
<li>i386</li>
<li>arm64</li>
</ul>
<h2><a class="header" href="#install" id="install">Install</a></h2>
<pre><code class="language-sh">sudo pkg install spotifyd
</code></pre>
<h2><a class="header" href="#configuring-spotifyd-1" id="configuring-spotifyd-1">Configuring spotifyd</a></h2>
<p>If you installed spotifyd using the above method, you'll either need to supply <code>--backend portaudio</code> as a command-line argument or add <code>backend = &quot;portaudio&quot;</code> to <code>/usr/local/etc/spotifyd.conf</code>.</p>
<p>Apart from that, spotifyd comes pre-configured with defaults that should be working in most cases, but if you want to tweak it further to your needs, have a look at the <a href="installation/../config/">configuration section</a> of this book.</p>
<h2><a class="header" href="#start-the-service-1" id="start-the-service-1">Start the service</a></h2>
<pre><code class="language-bash">sudo service spotifyd onestart
</code></pre>
<p>Now see if you can find it in the normal Spotify client (Devices in right bottom corner). Retry the above steps if you can't find it.</p>
<h2><a class="header" href="#starting-spotifyd-at-boot-1" id="starting-spotifyd-at-boot-1">Starting spotifyd at boot</a></h2>
<pre><code class="language-sh">sudo sysrc spotifyd_enable=YES
</code></pre>
<h1><a class="header" href="#configuration" id="configuration">Configuration</a></h1>
<p><code>Spotifyd</code> is able to run without configuration at all and will assume default values for most of the fields. However, running without configuration will only allow you to connect to it via Spotify Connect if you're on the same network as the daemon</p>
<h1><a class="header" href="#command-line-options" id="command-line-options">Command Line Options</a></h1>
<p><code>Spotifyd</code> can be configured using CLI arguments. For a detailed description as well as possible values for each flag, run</p>
<pre><code class="language-bash">spotifyd --help
</code></pre>
<h1><a class="header" href="#configuration-file" id="configuration-file">Configuration file</a></h1>
<p><code>Spotifyd</code> is able to load configuration values from a <a href="https://toml.io/en/v0.5.0">TOML</a> file too. The file has to be named <code>spotifyd.conf</code> and reside in the user's configuration directory (<code>~/.config/spotifyd</code>) or the system configuration directory (<code>/etc</code> or <code>/etc/xdg/spotifyd</code>). This also applies to macOS!</p>
<p>The configuration file consists of two sections, <code>global</code> and <code>spotifyd</code>, whereas <code>spotifyd</code> takes priority over <code>global</code>.</p>
<p>The configuration file has the following format:</p>
<pre><code class="language-toml">[global]
# Your Spotify account name.
username = &quot;username&quot;

# Your Spotify account password.
password = &quot;password&quot;

# A command that gets executed and can be used to
# retrieve your password.
# The command should return the password on stdout.
#
# This is an alternative to the `password` field. Both
# can't be used simultaneously.
password_cmd = &quot;command_that_writes_password_to_stdout&quot;

# If set to true, `spotifyd` tries to look up your
# password in the system's password storage.
#
# This is an alternative to the `password` field. Both
# can't be used simultaneously.
use_keyring = true

# If set to true, `spotifyd` tries to bind to dbus (default is the session bus)
# and expose MPRIS controls. When running headless, without the session bus,
# you should set this to false, to avoid errors. If you still want to use MPRIS,
# have a look at the `dbus_type` option.
use_mpris = true

# The bus to bind to with the MPRIS interface.
# Possible values: &quot;session&quot;, &quot;system&quot;
# The system bus can be used if no graphical session is available
# (e.g. on headless systems) but you still want to be able to use MPRIS.
# NOTE: You might need to add appropriate policies to allow spotifyd to
# own the name.
dbus_type = &quot;session&quot;

# The audio backend used to play music. To get
# a list of possible backends, run `spotifyd --help`.
backend = &quot;alsa&quot; # use portaudio for macOS [homebrew]

# The alsa audio device to stream audio. To get a
# list of valid devices, run `aplay -L`,
device = &quot;alsa_audio_device&quot;  # omit for macOS

# The alsa control device. By default this is the same
# name as the `device` field.
control = &quot;alsa_audio_device&quot;  # omit for macOS

# The alsa mixer used by `spotifyd`.
mixer = &quot;PCM&quot;  # omit for macOS

# The volume controller. Each one behaves different to
# volume increases. For possible values, run
# `spotifyd --help`.
volume_controller = &quot;alsa&quot;  # use softvol for macOS

# A command that gets executed in your shell after each song changes.
on_song_change_hook = &quot;command_to_run_on_playback_events&quot;

# The name that gets displayed under the connect tab on
# official clients. Spaces are not allowed!
device_name = &quot;device_name_in_spotify_connect&quot;

# The audio bitrate. 96, 160 or 320 kbit/s
bitrate = 160

# The directory used to cache audio data. This setting can save
# a lot of bandwidth when activated, as it will avoid re-downloading
# audio files when replaying them.
#
# Note: The file path does not get expanded. Environment variables and
# shell placeholders like $HOME or ~ don't work!
cache_path = &quot;cache_directory&quot;

# The maximal size of the cache directory in bytes
# The example value corresponds to ~ 1GB
max_cache_size = 1000000000

# If set to true, audio data does NOT get cached.
no_audio_cache = true

# Volume on startup between 0 and 100
# NOTE: This variable's type will change in v0.4, to a number (instead of string)
initial_volume = &quot;90&quot;

# If set to true, enables volume normalisation between songs.
volume_normalisation = true

# The normalisation pregain that is applied for each song.
normalisation_pregain = -10

# After the music playback has ended, start playing similar songs based on the previous tracks.
autoplay = true

# The port `spotifyd` uses to announce its service over the network.
zeroconf_port = 1234

# The proxy `spotifyd` will use to connect to spotify.
proxy = &quot;http://proxy.example.org:8080&quot;

# The displayed device type in Spotify clients.
# Can be unknown, computer, tablet, smartphone, speaker, t_v,
# a_v_r (Audio/Video Receiver), s_t_b (Set-Top Box), and audio_dongle.
device_type = &quot;speaker&quot;
</code></pre>
<h2><a class="header" href="#alternatives-to-storing-your-password-in-the-config-file----omit-in-toc---" id="alternatives-to-storing-your-password-in-the-config-file----omit-in-toc---">Alternatives to storing your password in the config file <!-- omit in toc --></a></h2>
<ul>
<li>
<p>use zeroconf authentication from Spotify Connect</p>
<p>Spotifyd is able to advertise itself on the network without credentials. To enable this, you must omit / comment any <code>username</code> / <code>username_cmd</code> or <code>password</code> / <code>password_cmd</code> in the configuration. Spotifyd will receive an authentication blob from Spotify when you choose it from the devices list.</p>
<blockquote>
<p><strong>Note:</strong> If you choose to go with this, it is also recommended to omit the <code>cache_path</code> and <code>cache_directory</code> options. Otherwise the first user to connect to the service will have its authentication blob cached by the service and nobody else will be able to connect to the service without clearing the cache.</p>
</blockquote>
<p>This way, a Spotifyd instance can also be made available to multiple users.</p>
<p>For more information, have a look at the <a href="https://github.com/librespot-org/librespot/blob/master/docs/authentication.md#zeroconf-based-authentication">librespot documentation</a>.</p>
</li>
<li>
<p><strong><code>password_cmd</code></strong> config entry</p>
<p>This feature allows you to provide a command that prints your password to <code>stdout</code>, which saves you from having to store your password in the config file directly. To use it, set the <code>password_cmd</code> config entry to the command you would like to use and remove the <code>password</code> config entry.</p>
<p>For example (using the password-management utility <a href="https://www.passwordstore.org/">pass</a>).</p>
<pre><code class="language-toml"># ~/.config/spotifyd/spotifyd.conf
password_cmd = &quot;pass spotify&quot;
</code></pre>
</li>
<li>
<p><strong><code>use_keyring</code></strong> config entry / <strong><code>--use-keyring</code></strong> CLI flag <!-- omit in toc --></p>
<p>This features leverages <a href="https://www.freedesktop.org/wiki/Specifications/secret-storage-spec/">Linux's DBus Secret Service API</a> or native macOS keychain in order to forgo the need to store your password directly in the config file. To use it, compile with the <code>dbus_keyring</code> feature and set the <code>use-keyring</code> config entry to <code>true</code> or pass the <code>--use-keyring</code> CLI flag  during start to the daemon. Remove the <code>password</code> and/or <code>password_cmd</code> config entries.</p>
<p>Your keyring entry needs to have the following attributes set:</p>
<pre><code class="language-yaml">application: rust-keyring
service: spotifyd
username: &lt;your-spotify-username&gt;
</code></pre>
<p>To add such an entry into your keyring, you can use <code>secret-tool</code>, a CLI used to communicate with agents that support the Secret Service API:</p>
<pre><code class="language-bash">secret-tool store --label='name you choose' application rust-keyring service spotifyd username &lt;your-username&gt;
</code></pre>
<p>You can use the keychain GUI on macOS to add an item respectively, or with the built-in <code>security</code> tool:</p>
<pre><code class="language-bash">security add-generic-password -s spotifyd -D rust-keyring -a &lt;your username&gt; -w
</code></pre>
</li>
</ul>
<h2><a class="header" href="#shell-used-to-run-commands-indicated-by-password_cmd-or-on_song_changed_hook----omit-in-toc---" id="shell-used-to-run-commands-indicated-by-password_cmd-or-on_song_changed_hook----omit-in-toc---">Shell used to run commands indicated by <code>password_cmd</code> or <code>on_song_changed_hook</code> <!-- omit in toc --></a></h2>
<p>If either of these options is given, the shell <code>spotifyd</code> will use to run its commands is the shell indicated by the <code>SHELL</code> environment variable, if set. If the <code>SHELL</code> environment variable is not set, <code>spotifyd</code> will use the user's default shell, which, on Linux and BSD, is the shell listed in <code>/etc/passwd</code>. On macOS it is the shell listed in the output of <code>dscl . -read /Users/&lt;username&gt; UserShell</code>.</p>
<h1><a class="header" href="#running-as-a-service" id="running-as-a-service">Running as a Service</a></h1>
<p>You can run Spotifyd as a service that automatically starts in the background.</p>
<h1><a class="header" href="#running-spotifyd-as-a-systemd-service" id="running-spotifyd-as-a-systemd-service">Running spotifyd as a systemd service</a></h1>
<h2><a class="header" href="#as-as-a-user-service" id="as-as-a-user-service">As as a user service</a></h2>
<p>A <code>systemd.service</code> unit file is provided to help run spotifyd as a service on systemd-based systems. The file <code>contrib/spotifyd.service</code> should be copied to either:</p>
<pre><code class="language-bash">/etc/systemd/user/
~/.config/systemd/user/
</code></pre>
<p>Packagers of systemd-based distributions are encouraged to include the file in the former location. End-user should prefer the latter. It should be noted that some targets are not available when running under the user directory, such as <code>network-online.target</code>.</p>
<p>Control of the daemon is handed over to systemd. The following command will start the service whenever the user logs in to the system. Logging out will stop the service.</p>
<pre><code class="language-bash">systemctl --user enable spotifyd.service --now
</code></pre>
<h2><a class="header" href="#as-a-system-wide-service" id="as-a-system-wide-service">As a system wide service</a></h2>
<p>A <code>systemd.service</code> unit file is provided to help run spotifyd as a service on systemd-based systems. The file <code>contrib/spotifyd.service</code> should be copied to:</p>
<pre><code class="language-bash">/etc/systemd/system/
</code></pre>
<p>Control of the daemon is handed over to systemd. The following example commands will start the service and keep it running across reboots.</p>
<pre><code class="language-bash">systemctl daemon-reload
systemctl enable spotifyd.service --now
</code></pre>
<h1><a class="header" href="#running-spotifyd-as-a-service-on-macos" id="running-spotifyd-as-a-service-on-macos">Running spotifyd as a service on macOS</a></h1>
<p>On macOS the system wide and per-user daemon/agent manager is known as <code>launchd</code>. Interfacing with <code>launchd</code> is performed through <code>launchctl</code>.</p>
<p>In order to use <code>spotifyd</code> as a service on macOS one must specify a <code>.plist</code> that represents the service, and place it in <code>/Library/LaunchDaemons</code>.</p>
<p>Here is a .plist which works with macOS Catalina 10.15.3:</p>
<pre><code class="language-xml">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;!DOCTYPE plist PUBLIC &quot;-//Apple//DTD PLIST 1.0//EN&quot; &quot;http://www.apple.com/DTDs/PropertyList-1.0.dtd&quot;&gt;
&lt;plist version=&quot;1.0&quot;&gt;
    &lt;dict&gt;
		&lt;key&gt;Label&lt;/key&gt;
		&lt;string&gt;rustlang.spotifyd&lt;/string&gt;
		&lt;key&gt;ProgramArguments&lt;/key&gt;
		&lt;array&gt;
			&lt;string&gt;/usr/local/bin/spotifyd&lt;/string&gt;
			&lt;string&gt;--config-path=/users/YourUserName/.config/spotifyd/spotifyd.conf&lt;/string&gt;
			&lt;string&gt;--no-daemon&lt;/string&gt;
		&lt;/array&gt;
		&lt;key&gt;UserName&lt;/key&gt;
		&lt;string&gt;YourUserName&lt;/string&gt;
		&lt;key&gt;KeepAlive&lt;/key&gt;
		&lt;true/&gt;
		&lt;key&gt;ThrottleInterval&lt;/key&gt;
		&lt;integer&gt;30&lt;/integer&gt;
	&lt;/dict&gt;
&lt;/plist&gt;
</code></pre>
<p>Once present in the <code>/Library/LaunchDaemons</code> directory, the .plist must be loaded and started with the following commands.</p>
<p><code>sudo launchctl load -w /Library/LaunchDaemons/rustlang.spotifyd.plist</code></p>
<p><code>sudo launchctl start /Library/LaunchDaemons/rustlang.spotifyd.plist</code></p>
<p>One may also unload/stop the service in a similar fashion replacing load/start with unload/stop.</p>
<p>Note:</p>
<ul>
<li>
<p>You should update &quot;YourUserName&quot; with your actual username for macOS (or remove &quot;UserName&quot; to run as root.</p>
</li>
<li>
<p>The string, <code>&lt;string&gt;--no-daemon&lt;/string&gt;</code> is needed as launchd won't receive a PID for the process and will lose its remit over spotifyd. So it's best to include it, there will be no difference in use, nor will you see any log output.</p>
</li>
<li>
<p>macOS tries to start the daemon immediately on boot, and spotifyd fails if Wifi isn't connected. So one must have a keep alive (which retries if it fails to launch on boot), that retries after 30 seconds, which is enough for wifi etc to come up.</p>
</li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
